# コスト最適化とスケール戦略

## 無料枠での運用

### GitHub Actions
- **無料枠**: 月2,000分（プライベートリポジトリ）
- **現在の使用量**: 約90分/月（最適化後）
- **余裕**: 22倍以上

### Cloudflare Workers  
- **無料枠**: 日10万リクエスト
- **現在の使用量**: 毎時1リクエスト + Discord API呼び出し
- **余裕**: 大幅に余裕あり

## GitHub Actions最適化

### 実行時間を90%削減
従来: Node.js環境構築で1-2分  
最適化後: curlのみで5-10秒

```yaml
# 不要な処理を削除:
# - checkout（コード不要）
# - Node.js setup（不要）  
# - npm install（不要）
# + エラーハンドリング追加
# + タイムアウト設定追加
```

## スケール容量

### 現在の設定での処理能力
- **リマインダー**: 600通知/分
- **締切通知**: 600通知/分（1,200 API呼び出し/分）

### ボトルネック
Discord APIレート制限が主な制約:
- チャンネルごと: 30メッセージ/分
- グローバル: 50リクエスト/秒

### 対応可能規模
- **現実的な上限**: 約10,000アクティブスケジュール
- **理論上の上限**: 日10万操作（Cloudflare Workers制限）

## 推奨設定

### デフォルト設定で十分なケース
- 100サーバー以下
- 毎時100通知以下

### 大規模運用時の調整
```bash
# 1,000サーバー以上の場合
wrangler secret put REMINDER_BATCH_SIZE  # 値: 10
wrangler secret put REMINDER_BATCH_DELAY  # 値: 200
```

## コスト比較

### 現在のアプローチ（curl）
- 実行時間: 5-10秒
- コスト: $0（無料枠内）

### 代替案
1. **Cloudflare Cron Triggers**: 
   - 無料枠あれば最適
   - 外部依存なし
   
2. **軽量Dockerイメージ**:
   - alpine:latest + curl
   - 実行時間はほぼ同じ
   - 複雑性が増すため非推奨

## まとめ

1. **現在の最適化で十分スケール可能**
   - 月2,000分の枠で22,000回実行可能
   - 毎時実行でも余裕

2. **主なボトルネックはDiscord API**
   - インフラコストではなくAPIレート制限が制約

3. **推奨事項**
   - デフォルト設定（5並列、500ms遅延）で開始
   - 必要に応じて環境変数で調整
   - 1,000サーバー超えたら設定見直し