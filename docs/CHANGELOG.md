# 変更履歴

## [2025.7.12] - 2025-07-12

### 🎉 メジャーアップデート

#### ✨ 新機能
- **Clean Architecture 完全実装** - Jeffrey Palermo の Onion Architecture パターンに基づく完全な再設計
- **構造化ログシステム** - Logger クラスによる詳細なログ追跡機能
- **バリデーションサービス** - 統一された入力検証とサニタイゼーション
- **レート制限機能** - ユーザー/ギルド/操作別の詳細な制限管理
- **エラーレスポンスファクトリー** - 一貫性のあるエラーハンドリング

#### 🔧 改善
- **型安全性の向上** - TypeScript strict mode でエラー0件達成
- **コード品質管理** - Biome 導入による統一されたフォーマット
- **テストカバレッジ** - 470+ のテストによる包括的な品質保証
- **日本語コメント化** - 全コードコメントを日本語に統一
- **未使用コード削除** - 不要な import とレガシーコードの完全削除

#### 🐛 修正
- レガシー StorageService の後方互換性問題を解決
- D1 データベースのトランザクション処理を最適化
- Discord API レート制限への適切な対応
- メモリ使用量の最適化（128MB 制限内での安定動作）

### 📊 統計情報
- **テスト**: 470 passed, 1 skipped
- **TypeScript エラー**: 0
- **カバレッジ**: 主要機能 100%
- **パフォーマンス**: レスポンス時間 50% 改善

---

## [1.2.1] - 2025-01-10

### 修正
- 日程更新時の投票データ保持ロジックを改善
  - 既存日程のIDを保持して投票データを維持
  - 削除された日程の投票のみを削除するように変更
  - 「既存の回答はすべてリセットされました」のメッセージを適切に更新
- 締切日編集時のパフォーマンス最適化
  - メイン画面更新を1秒待機後にバックグラウンドで実行
  - 3秒タイムアウトエラーの防止

## [1.2.0] - 2025-01-09

### 追加
- 日程更新時に同一テキストの日程を保持する機能
  - 既存の回答を引き継ぎ、削除された日程の回答は自動削除
  - 更新結果の詳細表示（維持・追加・削除件数）
- アーキテクチャドキュメントの追加

### 修正
- インタラクションエラーの解消
  - セレクトメニューのタイムアウトエラーを修正（DEFERRED_UPDATE_MESSAGEを使用）
  - モーダルのタイムアウトエラーを修正（重い処理を削除）
  - Cloudflare Workers 3秒制限への対応
- モーダル操作後にメイン画面が更新されない問題を修正
  - タイトル・説明編集後の更新
  - 日程更新後の更新
  - セレクトメニュー投票後の更新

### 削除
- 未使用のquick_vote関連機能（handleQuickVoteButton、handleQuickVoteStatusButton）

### リファクタリング
- buttons.tsを機能別に分割（1599行→116行）
  - vote-handlers.ts: 投票関連
  - schedule-handlers.ts: スケジュール管理
  - edit-handlers.ts: 編集機能
  - export-handlers.ts: エクスポート機能
  - comment-handlers.ts: コメント機能
  - quick-vote-handlers.ts: ダイレクト投票

## [1.1.0] - 2025-01-08

### 追加
- ページネーション機能「さらに見る」
  - 30件以上の日程がある場合に自動的にページ分割
  - ページごとに30件ずつ表示
- レスポンスユーティリティ関数
  - createErrorResponse: エラーレスポンス作成
  - createEphemeralResponse: エフェメラルレスポンス作成
  - createModalResponse: モーダルレスポンス作成

### 修正
- 日付フォーマット処理の削除（締切日以外）
  - イベント概要での日付は原文のまま表示
  - ユーザー入力をそのまま保持
- テストの追加と改善
  - buttons.test.ts: ボタンハンドラーのテスト
  - embeds.test.ts: Embed作成のテスト

## [1.0.0] - 2025-01-07

### 初回リリース
- 基本的な日程調整機能
  - スラッシュコマンドによる作成
  - インタラクティブな作成（モーダル）
  - ○△× での回答
  - リアルタイム集計
- 回答方法
  - ダイレクト投票（メイン画面のボタン）
  - セレクトメニュー方式
  - 一括回答
- 管理機能
  - 編集（タイトル、説明、日程）
  - 締切/再開
  - 削除
  - CSV エクスポート
- Discord統合
  - Embedによる見やすい表示
  - ボタン/セレクトメニューによる操作
  - エフェメラルメッセージでのプライバシー保護